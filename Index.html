<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>Platformă Genetică Medicală – Grile</title>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  margin: 0;
  background: #f5f5f5;
  color: #222;
}

header {
  background: #1f2937;
  color: white;
  padding: 20px;
  text-align: center;
}

main {
  max-width: 1000px;
  margin: auto;
  padding: 20px;
}

button {
  padding: 10px 16px;
  margin: 5px;
  border: none;
  background: #2563eb;
  color: white;
  cursor: pointer;
  border-radius: 6px;
}

button.secondary {
  background: #6b7280;
}

button.danger {
  background: #dc2626;
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.card {
  background: white;
  padding: 20px;
  margin-bottom: 20px;
  border-radius: 8px;
}

.hidden {
  display: none;
}

.option {
  margin: 8px 0;
}

.option input {
  margin-right: 8px;
}

#score {
  font-size: 20px;
  font-weight: bold;
}

footer {
  text-align: center;
  padding: 20px;
  font-size: 14px;
  color: #555;
}
</style>
</head>

<body>
<header>
  <h1>Genetică Medicală – Platformă de Grile</h1>
  <p>Practică + Simulare Examen</p>
</header>

<main id="app">
<!-- CONȚINUT DINAMIC -->
</main>

<footer>
  Platformă educațională – uz personal
</footer>
<script>
/* =========================
   STATE GLOBAL
========================= */
let currentCourse = null;
let currentMode = null;
let currentQuestionIndex = 0;
let userAnswers = [];
let questions = [];

/* =========================
   UI DE BAZĂ
========================= */
const app = document.getElementById("app");

function showHome() {
  app.innerHTML = `
    <div class="card">
      <h2>Selectează cursul</h2>
      <div id="courses"></div>
    </div>

    <div class="card hidden" id="modeCard">
      <h2 id="courseTitle"></h2>
      <button onclick="startPractice()">Mod Practică</button>
      <button onclick="startExam()">Simulare Examen</button>
      <button class="secondary" onclick="showHome()">Înapoi</button>
    </div>
  `;

  const coursesDiv = document.getElementById("courses");

  for (let i = 1; i <= 13; i++) {
    const btn = document.createElement("button");
    btn.textContent = `Curs ${i}`;
    btn.onclick = () => selectCourse(i);
    coursesDiv.appendChild(btn);
  }
}

function selectCourse(courseNumber) {
  currentCourse = courseNumber;
  document.getElementById("modeCard").classList.remove("hidden");
  document.getElementById("courseTitle").textContent = `Curs ${courseNumber}`;
}

/* =========================
   MODURI
========================= */
function startPractice() {
  currentMode = "practice";
  loadQuestionsForCourse(currentCourse);
}

function startExam() {
  currentMode = "exam";
  loadExamQuestions();
}

/* =========================
   INIT
========================= */
showHome();
</script>
<script>
/* =========================
   MOTOR DE DATE – STRUCTURĂ
========================= */

/*
  Fiecare întrebare are:
  - id (unic)
  - course (1–13)
  - type: "single" | "multiple"
  - text
  - options: { A, B, C, D, E? }
  - correct: ["A"] sau ["A","C"]
*/
const ALL_QUESTIONS = [];

/* Helper sigur pentru a adăuga întrebări */
function addQuestion(q) {
  if (!q.id || !q.course || !q.type || !q.text || !q.options || !q.correct) {
    console.error("Întrebare invalidă:", q);
    return;
  }
  ALL_QUESTIONS.push(q);
}

/* =========================
   EXEMPLE (structură validată)
   — setul complet vine în părțile următoare
========================= */

/* Curs 1 – exemple */
addQuestion({
  id: "C1_Q1",
  course: 1,
  type: "single",
  text: "Legătura fosfodiesterică se stabilește între:",
  options: {
    A: "C1 și fosfat",
    B: "C2 și fosfat",
    C: "C3 și fosfat",
    D: "C5 și bază"
  },
  correct: ["C"]
});

addQuestion({
  id: "C1_Q2",
  course: 1,
  type: "multiple",
  text: "Legile lui Chargaff includ:",
  options: {
    A: "A = T",
    B: "G = C",
    C: "A + G = T + C",
    D: "A = G"
  },
  correct: ["A", "B", "C"]
});

/* Curs 2 – exemple */
addQuestion({
  id: "C2_Q1",
  course: 2,
  type: "single",
  text: "Replicarea ADN are loc în faza:",
  options: {
    A: "G1",
    B: "S",
    C: "G2",
    D: "M"
  },
  correct: ["B"]
});

/* =========================
   LOADERE
========================= */

/* Practică – toate întrebările din curs */
function loadQuestionsForCourse(courseNumber) {
  questions = ALL_QUESTIONS.filter(q => q.course === courseNumber);
  if (questions.length === 0) {
    app.innerHTML = `<div class="card"><h3>Nu există încă întrebări pentru acest curs.</h3>
      <button class="secondary" onclick="showHome()">Înapoi</button></div>`;
    return;
  }
  currentQuestionIndex = 0;
  userAnswers = new Array(questions.length).fill(null);
  renderQuestion();
}

/* Examen – 50 întrebări, random, 20 multiple */
function loadExamQuestions() {
  const shuffled = [...ALL_QUESTIONS].sort(() => Math.random() - 0.5);
  const multiple = shuffled.filter(q => q.type === "multiple").slice(0, 20);
  const single = shuffled.filter(q => q.type === "single").slice(0, 30);
  questions = [...multiple, ...single].sort(() => Math.random() - 0.5);
  currentQuestionIndex = 0;
  userAnswers = new Array(questions.length).fill(null);
  renderQuestion();
}

/* Debug util */
console.log("Total întrebări încărcate:", ALL_QUESTIONS.length);
</script>
<script>
/* =========================
   RENDER ÎNTREBARE
========================= */

function renderQuestion() {
  if (!questions || questions.length === 0) {
    app.innerHTML = `<div class="card">
      <h3>Nu există întrebări încărcate.</h3>
      <button class="secondary" onclick="showHome()">Înapoi</button>
    </div>`;
    return;
  }

  const q = questions[currentQuestionIndex];
  const userAnswer = userAnswers[currentQuestionIndex] || [];

  let optionsHtml = "";

  Object.entries(q.options).forEach(([key, value]) => {
    const checked =
      q.type === "single"
        ? userAnswer === key
        : userAnswer.includes(key);

    const inputType = q.type === "single" ? "radio" : "checkbox";

    optionsHtml += `
      <label class="option">
        <input 
          type="${inputType}" 
          name="option"
          value="${key}"
          ${checked ? "checked" : ""}
          onchange="handleAnswer('${key}')"
        />
        <strong>${key}.</strong> ${value}
      </label>
    `;
  });

  app.innerHTML = `
    <div class="card">
      <div class="question-header">
        <div><strong>Întrebarea ${currentQuestionIndex + 1} / ${questions.length}</strong></div>
        <div class="question-meta">
          Curs ${q.course} • ${q.type === "single" ? "Complement simplu" : "Complement multiplu"}
        </div>
      </div>

      <div class="question-text">
        ${q.text}
      </div>

      <div class="options">
        ${optionsHtml}
      </div>

      <div class="nav-buttons">
        <button class="secondary" onclick="prevQuestion()" ${currentQuestionIndex === 0 ? "disabled" : ""}>
          ⬅ Înapoi
        </button>

        <button onclick="nextQuestion()">
          ${currentQuestionIndex === questions.length - 1 ? "Finalizare" : "Înainte ➡"}
        </button>
      </div>
    </div>
  `;
}

/* =========================
   GESTIONARE RĂSPUNSURI
========================= */

function handleAnswer(optionKey) {
  const q = questions[currentQuestionIndex];

  if (q.type === "single") {
    userAnswers[currentQuestionIndex] = optionKey;
  } else {
    let arr = userAnswers[currentQuestionIndex] || [];
    if (arr.includes(optionKey)) {
      arr = arr.filter(o => o !== optionKey);
    } else {
      arr.push(optionKey);
    }
    userAnswers[currentQuestionIndex] = arr;
  }
}

/* =========================
   NAVIGARE
========================= */

function nextQuestion() {
  if (currentQuestionIndex < questions.length - 1) {
    currentQuestionIndex++;
    renderQuestion();
  } else {
    showResults();
  }
}

function prevQuestion() {
  if (currentQuestionIndex > 0) {
    currentQuestionIndex--;
    renderQuestion();
  }
}

/* =========================
   REZULTATE
========================= */

function showResults() {
  let score = 0;

  questions.forEach((q, index) => {
    const user = userAnswers[index] || [];
    const correct = q.correct;

    const normalize = a => Array.isArray(a) ? a.sort().join("") : a;
    if (normalize(user) === normalize(correct)) {
      score++;
    }
  });

  app.innerHTML = `
    <div class="card">
      <h2>Rezultat</h2>
      <p><strong>${score}</strong> / ${questions.length} corecte</p>
      <button onclick="showHome()">Înapoi la meniu</button>
    </div>
  `;
}
</script>
<style>
/* =========================
   RESET & BASE
========================= */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  background: #f4f6f8;
  color: #1f2937;
  line-height: 1.5;
}

#app {
  max-width: 900px;
  margin: 40px auto;
  padding: 20px;
}

/* =========================
   CARD
========================= */
.card {
  background: #ffffff;
  border-radius: 10px;
  padding: 28px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.06);
}

/* =========================
   HEADERS
========================= */
h1, h2, h3 {
  margin-bottom: 16px;
}

h1 {
  font-size: 28px;
}

h2 {
  font-size: 22px;
}

h3 {
  font-size: 18px;
  color: #374151;
}

/* =========================
   HOME MENU
========================= */
.course-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 12px;
  margin-top: 20px;
}

.course-grid button {
  padding: 14px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  background: #f9fafb;
  cursor: pointer;
  font-weight: 600;
}

.course-grid button:hover {
  background: #eef2ff;
  border-color: #6366f1;
}

/* =========================
   QUESTION
========================= */
.question-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  font-size: 14px;
  color: #6b7280;
}

.question-text {
  font-size: 18px;
  margin-bottom: 20px;
  font-weight: 500;
}

/* =========================
   OPTIONS
========================= */
.options {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 24px;
}

.option {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  cursor: pointer;
}

.option:hover {
  background: #f3f4f6;
}

.option input {
  margin-top: 4px;
}

/* =========================
   BUTTONS
========================= */
button {
  padding: 10px 18px;
  border-radius: 8px;
  border: none;
  background: #4f46e5;
  color: #ffffff;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
}

button:hover {
  background: #4338ca;
}

button.secondary {
  background: #e5e7eb;
  color: #111827;
}

button.secondary:hover {
  background: #d1d5db;
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* =========================
   NAVIGATION
========================= */
.nav-buttons {
  display: flex;
  justify-content: space-between;
  gap: 12px;
}

/* =========================
   RESULTS
========================= */
.result {
  text-align: center;
}

.result p {
  font-size: 18px;
  margin: 12px 0;
}

/* =========================
   MOBILE
========================= */
@media (max-width: 600px) {
  #app {
    margin: 20px auto;
    padding: 12px;
  }

  .card {
    padding: 20px;
  }

  .question-text {
    font-size: 16px;
  }
}
</style>
<script>
/* =========================
   LOAD QUESTIONS
========================= */

function loadQuestionsForCourse(course) {
  // TOATE întrebările din curs
  questions = data.filter(q => q.course === course);

  if (questions.length === 0) {
    alert("Nu există întrebări pentru acest curs.");
    showHome();
    return;
  }

  currentQuestionIndex = 0;
  userAnswers = new Array(questions.length).fill(null);

  renderQuestion();
}

/* =========================
   EXAM MODE (50 MCQ)
========================= */
function loadExamQuestions() {
  const allQuestions = data.filter(q => q.course === currentCourse);

  const simple = allQuestions.filter(q => q.type === "single");
  const multiple = allQuestions.filter(q => q.type === "multiple");

  shuffle(simple);
  shuffle(multiple);

  const examSet = [
    ...simple.slice(0, 30),
    ...multiple.slice(0, 20)
  ];

  shuffle(examSet);

  questions = examSet;
  currentQuestionIndex = 0;
  userAnswers = new Array(questions.length).fill(null);

  renderQuestion();
}

/* =========================
   SHUFFLE
========================= */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}
</script>
<script>
/* =========================
   RENDER QUESTION
========================= */

function renderQuestion() {
  const q = questions[currentQuestionIndex];

  document.getElementById("questionCounter").innerText =
    `Întrebarea ${currentQuestionIndex + 1} / ${questions.length}`;

  document.getElementById("questionText").innerText = q.text;

  const answersDiv = document.getElementById("answers");
  answersDiv.innerHTML = "";

  const savedAnswer = userAnswers[currentQuestionIndex];

  q.options.forEach((opt, index) => {
    const wrapper = document.createElement("div");
    wrapper.className = "answer-option";

    const input = document.createElement("input");
    input.type = q.type === "single" ? "radio" : "checkbox";
    input.name = "answer";
    input.value = index;

    // restore answer
    if (savedAnswer !== null) {
      if (q.type === "single" && savedAnswer === index) {
        input.checked = true;
      }
      if (q.type === "multiple" && savedAnswer.includes(index)) {
        input.checked = true;
      }
    }

    input.onchange = () => saveAnswer(q.type);

    const label = document.createElement("label");
    label.innerText = opt;

    wrapper.appendChild(input);
    wrapper.appendChild(label);
    answersDiv.appendChild(wrapper);
  });
}

/* =========================
   SAVE ANSWER
========================= */

function saveAnswer(type) {
  if (type === "single") {
    const selected = document.querySelector('input[name="answer"]:checked');
    userAnswers[currentQuestionIndex] = selected
      ? parseInt(selected.value)
      : null;
  }

  if (type === "multiple") {
    const checked = Array.from(
      document.querySelectorAll('input[name="answer"]:checked')
    ).map(i => parseInt(i.value));

    userAnswers[currentQuestionIndex] = checked;
  }
}

/* =========================
   NAVIGATION
========================= */

function nextQuestion() {
  if (currentQuestionIndex < questions.length - 1) {
    currentQuestionIndex++;
    renderQuestion();
  }
}

function prevQuestion() {
  if (currentQuestionIndex > 0) {
    currentQuestionIndex--;
    renderQuestion();
  }
}
</script>
<script>
/* =========================
   CALCUL SCORE
========================= */

function calculateScore() {
  let score = 0;

  questions.forEach((q, index) => {
    const user = userAnswers[index];
    const correct = q.correct;

    if (q.type === "single") {
      if (user === correct) score++;
    }

    if (q.type === "multiple") {
      if (
        Array.isArray(user) &&
        user.length === correct.length &&
        user.every(v => correct.includes(v))
      ) {
        score++;
      }
    }
  });

  return score;
}

/* =========================
   FINISH EXAM
========================= */

function finishExam() {
  const score = calculateScore();
  const percent = Math.round((score / questions.length) * 100);

  document.getElementById("quiz").style.display = "none";
  document.getElementById("result").style.display = "block";

  document.getElementById("finalScore").innerText =
    `Scor: ${score} / ${questions.length} (${percent}%)`;
}
</script>
<script>
/* =========================
   MODE CONTROL
========================= */

let mode = "practice"; // practice | exam

function startPractice(course) {
  mode = "practice";
  currentCourse = course;
  loadQuestionsForCourse(course);
  showQuiz();
}

function startExam(course) {
  mode = "exam";
  currentCourse = course;
  loadExamQuestions();
  showQuiz();
}

/* =========================
   CHECK ANSWER (PRACTICE)
========================= */

function checkAnswerPractice() {
  if (mode !== "practice") return;

  const q = questions[currentQuestionIndex];
  const user = userAnswers[currentQuestionIndex];

  let correct = false;

  if (q.type === "single") {
    correct = user === q.correct;
  }

  if (q.type === "multiple") {
    correct =
      Array.isArray(user) &&
      user.length === q.correct.length &&
      user.every(v => q.correct.includes(v));
  }

  const feedback = document.getElementById("feedback");
  feedback.style.display = "block";

  feedback.innerText = correct
    ? "✔ Răspuns corect"
    : `✖ Răspuns greșit. Corect: ${formatCorrect(q)}`;
}

/* =========================
   FORMAT CORECT ANSWER
========================= */

function formatCorrect(q) {
  if (q.type === "single") {
    return q.options[q.correct];
  }

  return q.correct.map(i => q.options[i]).join(", ");
}
</script>
<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>Grile Genetică Medicală</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f6f8;
    }

    h1, h2 {
      text-align: center;
    }

    button {
      padding: 10px 16px;
      margin: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .course-btn {
      display: block;
      width: 100%;
      margin-bottom: 8px;
    }

    #quiz, #result {
      display: none;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
    }

    .answer-option {
      margin: 8px 0;
    }

    #feedback {
      margin-top: 10px;
      font-weight: bold;
    }

    #navigation {
      margin-top: 20px;
    }
  </style>
</head>

<body>

<h1>Platformă Grile – Genetică Medicală</h1>

<!-- HOME -->
<div id="home">
  <h2>Selectează cursul</h2>

  <!-- CURSURI -->
  <div id="courses">
    <!-- butoanele sunt generate din JS -->
  </div>
</div>

<!-- QUIZ -->
<div id="quiz">
  <div id="questionCounter"></div>
  <h2 id="questionText"></h2>

  <div id="answers"></div>

  <div id="feedback" style="display:none;"></div>

  <div id="navigation">
    <button onclick="prevQuestion()">Înapoi</button>
    <button onclick="checkAnswerPractice()">Verifică</button>
    <button onclick="nextQuestion()">Înainte</button>
    <button onclick="finishExam()">Finalizează</button>
  </div>
</div>

<!-- RESULT -->
<div id="result">
  <h2>Rezultat final</h2>
  <p id="finalScore"></p>
  <button onclick="location.reload()">Înapoi la cursuri</button>
</div>

<!-- DATA -->
<script src="data.js"></script>

<!-- LOGIC (toate părțile 6–9 aici) -->
<script>
/* variabile globale */
let questions = [];
let userAnswers = [];
let currentQuestionIndex = 0;
let currentCourse = null;
let mode = "practice";

/* UI */
function showQuiz() {
  document.getElementById("home").style.display = "none";
  document.getElementById("quiz").style.display = "block";
}

function showHome() {
  document.getElementById("quiz").style.display = "none";
  document.getElementById("home").style.display = "block";
}

/* GENEREAZĂ BUTOANE CURS */
function initCourses() {
  const coursesDiv = document.getElementById("courses");

  const courses = [...new Set(data.map(q => q.course))].sort();

  courses.forEach(course => {
    const btnPractice = document.createElement("button");
    btnPractice.className = "course-btn";
    btnPractice.innerText = `Curs ${course} – Practică`;
    btnPractice.onclick = () => startPractice(course);

    const btnExam = document.createElement("button");
    btnExam.className = "course-btn";
    btnExam.innerText = `Curs ${course} – Examen`;
    btnExam.onclick = () => startExam(course);

    coursesDiv.appendChild(btnPractice);
    coursesDiv.appendChild(btnExam);
  });
}

initCourses();
</script>

</body>
</html>
const data = [
  {
    id: "C1-Q1",
    course: 1,
    type: "single", // "single" | "multiple"
    text: "Legătura fosfodiesterică se realizează între:",
    options: [
      "C3 al pentozei și fosfatul C5 al nucleotidei vecine",
      "C1 al pentozei și baza azotată",
      "Două baze purinice",
      "Două zaharuri"
    ],
    correct: 0
  },

  {
    id: "C1-Q2",
    course: 1,
    type: "multiple",
    text: "Legile lui Chargaff sunt:",
    options: [
      "A + G = T + C",
      "A/T = 1",
      "G/C = 1",
      "A + T / G + C = 1"
    ],
    correct: [0,1,2]
  },

  {
    id: "C2-Q1",
    course: 2,
    type: "single",
    text: "Replicarea ADN-ului are loc în faza:",
    options: [
      "G1",
      "S",
      "G2",
      "M"
    ],
    correct: 1
  }
];
  <script>
/* =========================
   DATA VALIDATION
========================= */

(function validateData() {
  if (!Array.isArray(data)) {
    alert("EROARE: data nu este un array.");
    throw new Error("data is not an array");
  }

  data.forEach((q, i) => {
    const prefix = `Întrebare index ${i}`;

    // id
    if (!q.id || typeof q.id !== "string") {
      throw new Error(`${prefix}: id lipsă sau invalid`);
    }

    // course
    if (typeof q.course !== "number" || q.course < 1 || q.course > 13) {
      throw new Error(`${prefix} (${q.id}): course invalid`);
    }

    // type
    if (q.type !== "single" && q.type !== "multiple") {
      throw new Error(`${prefix} (${q.id}): type invalid`);
    }

    // text
    if (!q.text || typeof q.text !== "string") {
      throw new Error(`${prefix} (${q.id}): text lipsă`);
    }

    // options
    if (!Array.isArray(q.options) || q.options.length < 2) {
      throw new Error(`${prefix} (${q.id}): options invalid`);
    }

    // correct
    if (q.type === "single") {
      if (
        typeof q.correct !== "number" ||
        q.correct < 0 ||
        q.correct >= q.options.length
      ) {
        throw new Error(`${prefix} (${q.id}): correct invalid (single)`);
      }
    }

    if (q.type === "multiple") {
      if (
        !Array.isArray(q.correct) ||
        q.correct.length === 0 ||
        q.correct.some(
          idx =>
            typeof idx !== "number" ||
            idx < 0 ||
            idx >= q.options.length
        )
      ) {
        throw new Error(`${prefix} (${q.id}): correct invalid (multiple)`);
      }
    }
  });

  console.log(`✔ data.js validată: ${data.length} întrebări OK`);
})();
</script>
<script>
/* =========================
   STATISTICS STORAGE
========================= */

// salvăm progresul în localStorage
function saveResult(course, score, total) {
  const stats = JSON.parse(localStorage.getItem("stats")) || {};

  if (!stats[course]) {
    stats[course] = {
      attempts: 0,
      best: 0,
      last: 0
    };
  }

  stats[course].attempts += 1;
  stats[course].last = score;
  stats[course].best = Math.max(stats[course].best, score);

  localStorage.setItem("stats", JSON.stringify(stats));
}

/* =========================
   EXTEND FINISH EXAM
========================= */

const originalFinishExam = finishExam;

finishExam = function () {
  const score = calculateScore();
  const total = questions.length;
  const percent = Math.round((score / total) * 100);

  saveResult(currentCourse, score, total);

  document.getElementById("quiz").style.display = "none";
  document.getElementById("result").style.display = "block";

  document.getElementById("finalScore").innerText =
    `Curs ${currentCourse}: ${score}/${total} (${percent}%)`;
};

/* =========================
   SHOW STATS
========================= */

function showStats() {
  const stats = JSON.parse(localStorage.getItem("stats")) || {};
  let text = "STATISTICI:\n\n";

  Object.keys(stats).forEach(course => {
    const s = stats[course];
    text += `Curs ${course} → încercări: ${s.attempts}, best: ${s.best}, last: ${s.last}\n`;
  });

  alert(text || "Nicio statistică disponibilă.");
}
</script>
<script>
/* =========================
   STORE WRONG QUESTIONS
========================= */

function saveWrongQuestions() {
  const wrong = [];

  questions.forEach((q, i) => {
    const user = userAnswers[i];
    let correct = false;

    if (q.type === "single") {
      correct = user === q.correct;
    }

    if (q.type === "multiple") {
      correct =
        Array.isArray(user) &&
        user.length === q.correct.length &&
        user.every(v => q.correct.includes(v));
    }

    if (!correct) wrong.push(q.id);
  });

  const allWrong =
    JSON.parse(localStorage.getItem("wrongQuestions")) || {};

  if (!allWrong[currentCourse]) {
    allWrong[currentCourse] = [];
  }

  allWrong[currentCourse] = Array.from(
    new Set([...allWrong[currentCourse], ...wrong])
  );

  localStorage.setItem("wrongQuestions", JSON.stringify(allWrong));
}

/* =========================
   EXTEND FINISH EXAM AGAIN
========================= */

const originalFinishExam2 = finishExam;

finishExam = function () {
  const score = calculateScore();
  const total = questions.length;
  const percent = Math.round((score / total) * 100);

  saveResult(currentCourse, score, total);
  saveWrongQuestions();

  document.getElementById("quiz").style.display = "none";
  document.getElementById("result").style.display = "block";

  document.getElementById("finalScore").innerText =
    `Curs ${currentCourse}: ${score}/${total} (${percent}%)`;
};

/* =========================
   PRACTICE WRONG ONLY
========================= */

function practiceWrong(course) {
  const allWrong =
    JSON.parse(localStorage.getItem("wrongQuestions")) || {};

  const wrongIds = allWrong[course] || [];

  questions = data.filter(q => wrongIds.includes(q.id));

  if (questions.length === 0) {
    alert("Nu ai întrebări greșite pentru acest curs.");
    return;
  }

  currentCourse = course;
  mode = "practice";
  currentQuestionIndex = 0;
  userAnswers = new Array(questions.length).fill(null);

  showQuiz();
  renderQuestion();
}

/* =========================
   RANDOM PRACTICE
========================= */

function practiceRandom(course, count = 20) {
  const pool = data.filter(q => q.course === course);
  shuffle(pool);

  questions = pool.slice(0, Math.min(count, pool.length));

  currentCourse = course;
  mode = "practice";
  currentQuestionIndex = 0;
  userAnswers = new Array(questions.length).fill(null);

  showQuiz();
  renderQuestion();
}
</script>
<script>
function updateUIForMode() {
  const checkBtn = document.querySelector(
    'button[onclick="checkAnswerPractice()"]'
  );

  if (mode === "exam") {
    checkBtn.style.display = "none";
  } else {
    checkBtn.style.display = "inline-block";
  }
}

// suprascriem showQuiz
const originalShowQuiz = showQuiz;
showQuiz = function () {
  originalShowQuiz();
  updateUIForMode();
};
</script>
<script>
function updateFinishButton() {
  const btn = document.querySelector(
    'button[onclick="finishExam()"]'
  );

  btn.style.display =
    currentQuestionIndex === questions.length - 1
      ? "inline-block"
      : "none";
}

const originalRender = renderQuestion;
renderQuestion = function () {
  originalRender();
  updateFinishButton();
};
</script>
